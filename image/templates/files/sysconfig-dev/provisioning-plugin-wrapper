#!/bin/bash
#
# provisioning-plugin wrapper script for development environment
# This script executes the provisioning-plugin binary from /repo/dev-bin/
#

set -o errexit
set -o pipefail

REPO_PATH="/repo"
BINARY_PATH="$REPO_PATH/dev-bin/provisioning-plugin"

# Check if repo is mounted
if [[ ! -d "$REPO_PATH" ]]; then
    echo "Error: /repo directory not found. Is the 9P filesystem mounted?" >&2
    exit 1
fi

# Check if binary exists
if [[ ! -x "$BINARY_PATH" ]]; then
    echo "Error: provisioning-plugin binary not found at $BINARY_PATH" >&2
    echo "Run on host: mise run dev:prepare-binaries" >&2
    exit 1
fi

# Execute the binary with all arguments
echo "Starting provisioning-plugin from: $BINARY_PATH" >&2
exec "$BINARY_PATH" "$@"
