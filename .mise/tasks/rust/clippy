#!/usr/bin/env bash
# Lint all Rust crates with clippy (deny warnings)
set -euo pipefail
SCRIPT_DIR=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &>/dev/null && pwd)
ROOT_DIR="${SCRIPT_DIR}/../../.."
cd "$ROOT_DIR"

CRATES=(
  image-builder
  imgdepot
  installadm
  installer-ui
  instcomd
  instcomd/migration
  machineconfig
  machined
  ociclient
  sysconfig
  sysconfig-cli
  sysconfig-config-schema
  sysconfig-plugins
  sysconfig-provisioning
)

for crate in "${CRATES[@]}"; do
  if [[ -f "$crate/Cargo.toml" ]]; then
    echo "==> Clippy $crate"
    (cd "$crate" && cargo clippy --all-targets -- -D warnings)
  fi
done
